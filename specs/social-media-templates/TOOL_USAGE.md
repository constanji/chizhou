# SocialMedia 工具使用说明

## 概述

`SocialMedia` 是一个类似 `Speckit` 的工具，专门用于生成朋友圈内容。它可被集成到工具系统中，可以通过智能体直接调用。

## 工具命令

### 1. `/social.generate` - 生成朋友圈内容

根据用户输入生成朋友圈内容。

**使用方式**：
```
/social.generate 今天和朋友去了一家新开的日料店，点了寿司和拉面，味道很不错，人均200左右
```

**参数**：
- `arguments` (必需): 用户输入的内容描述
- `scenario` (可选): 场景类型（food, travel, event, achievement, daily, general）
- `style` (可选): 内容风格（casual, formal, enthusiastic 等）

**示例**：
```json
{
  "command": "generate",
  "arguments": "今天和朋友去了一家新开的日料店，点了寿司和拉面，味道很不错，人均200左右",
  "scenario": "food",
  "style": "casual"
}
```

**自动场景检测**：
如果不指定 `scenario`，工具会自动检测：
- 美食相关关键词 → `food`
- 旅行相关关键词 → `travel`
- 活动相关关键词 → `event`
- 成就相关关键词 → `achievement`
- 日常相关关键词 → `daily`
- 其他 → `general`

### 2. `/social.templates` - 列出可用模板

列出所有可用的模板和格式规范。

**使用方式**：
```
/social.templates
```

**返回信息**：
- 所有场景模板列表
- 格式规范文件列表
- 使用说明

### 3. `/social.format` - 格式化内容

根据格式规范格式化已有的朋友圈内容。

**使用方式**：
```
/social.format [要格式化的内容]
```

**参数**：
- `arguments` (必需): 需要格式化的内容

## 工具工作原理

1. **接收用户输入**：工具接收用户的内容描述
2. **场景检测**：自动检测或使用指定的场景类型
3. **加载模板**：加载对应的场景模板和命令模板
4. **提取信息**：从用户输入中提取关键信息（时间、地点、人物、事件、感受等）
5. **变量替换**：替换模板中的占位符
6. **应用格式**：根据格式规范调整内容格式
7. **生成内容**：生成最终的朋友圈内容

## 在智能体中使用

### 方式一：直接命令调用

用户可以直接在对话中使用命令：

```
用户：/social.generate 今天去了故宫，天气很好，拍了很多照片，感觉很震撼
```

### 方式二：自然语言描述

用户也可以用自然语言描述，智能体会自动调用工具：

```
用户：帮我生成一条朋友圈，内容是今天去了故宫，天气很好，拍了很多照片，感觉很震撼
```

智能体会：
1. 识别这是朋友圈生成需求
2. 调用 `/social.generate` 工具
3. 自动检测场景（旅行场景）
4. 生成朋友圈内容

## 工具返回格式

工具返回 JSON 格式的响应，包含：

```json
{
  "success": true,
  "message": "朋友圈内容生成命令已识别...",
  "user_input": "用户输入的内容",
  "detected_scenario": "travel",
  "template_path": "specs/social-media-templates/templates/scenario-templates/travel-post.md",
  "dynamic_variables": {
    "date": "2025年12月5日",
    "time": "14:30",
    "weekDay": "星期四"
  },
  "templates": {
    "command_template": "...",
    "scenario_template": "...",
    "format_guides": {...}
  },
  "instructions": [
    "1. 分析用户输入，提取关键信息...",
    "2. 根据场景模板的结构，组织内容...",
    ...
  ]
}
```

## LLM 处理流程

当工具返回后，LLM 应该：

1. **读取命令模板**：了解生成流程和步骤
2. **读取场景模板**：了解内容结构和占位符
3. **提取信息**：从用户输入中提取所有关键信息
4. **替换变量**：
   - 使用动态变量（日期、时间等）
   - 使用从用户输入提取的信息
5. **应用格式规范**：
   - 检查文本格式
   - 添加合适的表情符号
   - 生成相关的话题标签
6. **生成最终内容**：组合所有部分，生成完整的朋友圈内容
7. **返回给用户**：提供可直接发布的内容

## 示例工作流程

### 用户输入：
```
今天和朋友去了一家新开的日料店，点了寿司和拉面，味道很不错，环境也很好，人均200左右
```

### 工具调用：
```json
{
  "command": "generate",
  "arguments": "今天和朋友去了一家新开的日料店，点了寿司和拉面，味道很不错，环境也很好，人均200左右"
}
```

### 工具返回：
- 检测到场景：`food`（美食场景）
- 加载模板：`food-post.md`
- 提供动态变量和格式规范

### LLM 处理：
1. 提取信息：
   - 时间：今天
   - 人物：朋友
   - 地点：新开的日料店
   - 美食：寿司、拉面
   - 评价：味道不错、环境好
   - 价格：人均200左右

2. 生成内容：
```
🍣 今天和朋友打卡了一家新开的日料店！

终于吃到了心心念念的寿司和拉面，味道真的很不错！寿司新鲜，拉面汤底浓郁，环境也很日式，氛围感满满。

人均200左右，性价比还可以，推荐给喜欢日料的朋友们！

#日料探店 #美食分享 #周末好去处
```

## 与 Speckit 的对比

| 特性 | Speckit | SocialMedia |
|------|---------|-------------|
| 用途 | 软件开发规范 | 朋友圈内容生成 |
| 命令格式 | `/speckit.xxx` | `/social.xxx` |
| 模板位置 | `.specify/templates/` | `specs/social-media-templates/templates/` |
| 输出 | 技术文档 | 朋友圈内容 |
| 场景支持 | 功能规范、计划等 | 美食、旅行、活动等 |

## 注意事项

1. **模板文件位置**：确保模板文件在 `specs/social-media-templates/` 目录下
2. **权限**：工具不需要特殊权限，可以直接使用
3. **错误处理**：如果模板文件不存在，工具会返回错误信息
4. **自动检测**：场景自动检测基于关键词匹配，可能不够精确，建议明确指定场景

## 故障排除

### 问题：工具未加载

**解决方案**：
1. 检查 `api/app/clients/tools/structured/SocialMedia.js` 文件是否存在
2. 检查 `api/app/clients/tools/index.js` 中是否导入了 SocialMedia
3. 检查 `api/app/clients/tools/util/handleTools.js` 中是否注册了工具
4. 重启服务器

### 问题：模板文件未找到

**解决方案**：
1. 确认 `specs/social-media-templates/` 目录存在
2. 确认模板文件在正确的位置
3. 检查文件路径是否正确

### 问题：场景检测不准确

**解决方案**：
1. 明确指定 `scenario` 参数
2. 在用户输入中使用更明确的关键词
3. 查看 `detectScenario` 方法中的关键词列表

## 扩展开发

如果需要添加新功能：

1. **添加新命令**：在 `SocialMedia.js` 的 `schema` 中添加新的 command
2. **实现处理函数**：创建对应的 `handleXxx` 方法
3. **更新路由**：在 `_call` 方法的 switch 中添加新命令的处理

---

**最后更新**：2025-12-05  
**版本**：1.0.0

