---
description: 根据用户需求生成一套完整的模板系统，遵循 .specify 的设计思路和结构模式
handoffs: []
scripts: []
---

## 用户输入

```text
$ARGUMENTS
```

在继续之前，你**必须**考虑用户输入（如果不为空）。

## 概述

目标：根据用户输入生成一套完整的模板系统，包括文档模板、命令模板、检查清单模板等，遵循 `.specify` 的设计思路和结构模式。

注意：此命令将在 `.specoutput` 目录下创建一个任务文件夹，并在其中生成一套完整的模板系统结构。生成的模板应该可以直接使用，智能体可以根据这些模板生成具体的文档。

执行步骤：

1. **分析用户需求**
   - 从用户输入中提取模板系统目标
   - 识别需要的模板类型（文档模板、命令模板、检查清单模板等）
   - 确定目录结构需求
   - 识别占位符需求（动态/静态/脚本占位符）

2. **创建任务文件夹**

   a. **确定任务文件夹名称**：
      - 基于用户需求生成一个简洁的文件夹名称（2-4 个词，使用连字符分隔）
      - 如果用户输入包含明确的名称，使用该名称
      - 否则，从用户需求中提取关键词生成名称
      - 示例：
        - "代码审查模板系统" → `code-review-templates`
        - "API 文档生成器" → `api-doc-generator`
        - "项目计划模板" → `project-plan-templates`

   b. **创建目录结构**：
      - 确保 `.specoutput` 目录存在（如果不存在则创建）：
        ```bash
        mkdir -p .specoutput
        ```
      - 检查任务文件夹是否已存在：
        ```bash
        if [ -d ".specoutput/[task-folder-name]" ]; then
          # 使用带时间戳的名称
          TASK_FOLDER=".specoutput/[task-folder-name]-$(date +%Y%m%d-%H%M%S)"
        else
          TASK_FOLDER=".specoutput/[task-folder-name]"
        fi
        mkdir -p "$TASK_FOLDER"
        ```
      - 在 `.specoutput` 目录下创建任务文件夹：`.specoutput/[task-folder-name]/`
      - 如果任务文件夹已存在，使用带时间戳的名称：`.specoutput/[task-folder-name]-YYYYMMDD-HHMMSS/`

   c. **创建基础目录结构**：
      - 在任务文件夹内创建所有必要的子目录：
        ```bash
        mkdir -p "$TASK_FOLDER/templates/commands"
        mkdir -p "$TASK_FOLDER/scripts/bash"
        mkdir -p "$TASK_FOLDER/scripts/powershell"
        ```
      - 最终结构：
        ```
        .specoutput/[task-folder-name]/
        ├── templates/
        │   └── commands/ (如果需要命令模板)
        ├── scripts/ (可选)
        │   ├── bash/
        │   └── powershell/
        └── README.md
        ```

3. **设计模板系统结构**

   - 在任务文件夹内设计完整的目录结构：
     ```
     .specoutput/[task-folder-name]/
     ├── templates/
     │   ├── [document-type]-template.md
     │   ├── [another-type]-template.md
     │   └── commands/ (如果需要)
     │       ├── [command-name].md
     │       └── [another-command].md
     ├── scripts/ (可选)
     │   ├── bash/
     │   └── powershell/
     └── README.md
     ```
   - 根据用户需求调整结构（添加/删除目录）
   - 确保所有目录都已创建

4. **生成模板文件**

   在 `.specoutput/[task-folder-name]/` 目录下，对于每种需要的模板类型，参考 `.specify/templates/` 和 `.specify/spec4spec/templates/` 中的对应模板，生成新的模板。

   **重要**：
   - 所有文件必须写入到 `$TASK_FOLDER` 目录下（或使用完整路径 `.specoutput/[task-folder-name]/`）
   - 使用 `write` 工具创建文件，确保路径正确
   - 文件路径示例：
     - 文档模板：`.specoutput/[task-folder-name]/templates/[document-type]-template.md`
     - 命令模板：`.specoutput/[task-folder-name]/templates/commands/[command-name].md`
     - 检查清单模板：`.specoutput/[task-folder-name]/templates/[checklist-type]-template.md`

   a. **文档模板**（如果需要）：
      - 参考 `.specify/templates/spec-template.md` 或 `.specify/templates/plan-template.md`
      - 使用以下结构模式：
        ```markdown
        # [文档类型]：[占位符-标题]
        
        **元数据字段 1**：`[占位符-值]`  
        **元数据字段 2**：[占位符-值]  
        **状态**：[占位符-状态]  
        **输入**：[占位符-输入源]
        
        ## 必需部分 1 *（必需）*
        
        <!--
          指导说明：这部分应该包含什么内容
          为什么需要这部分
          如何填写这部分
        -->
        
        [内容结构，包含占位符]
        
        ### 子部分 1.1
        
        [具体内容模板]
        
        **示例**：
        - **项目 1**：[占位符-描述]
        - **项目 2**：[占位符-描述]
        
        ---
        
        ## 必需部分 2 *（必需）*
        
        [类似结构]
        
        ---
        
        ## 可选部分 *（可选）*
        
        <!--
          何时包含此部分
          何时可以省略
        -->
        
        [内容结构]
        ```
      - 占位符规则：
        - 使用 `[占位符-描述]` 格式
        - 占位符应该清晰描述期望的内容类型
        - 在注释中说明如何填充占位符
      - 注释规则：
        - 使用 HTML 注释 `<!-- -->` 提供指导
        - 说明每个部分的用途和填写方法
        - 标记必需部分和可选部分

   b. **命令模板**（如果需要）：
      - 参考 `.specify/templates/commands/specify.md` 或 `.specify/templates/commands/clarify.md`
      - 使用以下结构模式：
        ```markdown
        ---
        description: [命令的简要描述]
        handoffs: 
          - label: [交接标签]
            agent: [目标代理名称]
            prompt: [交接提示]
        scripts:
          sh: [bash脚本路径] [参数]
          ps: [powershell脚本路径] [参数]
        ---
        
        ## 用户输入
        
        ```text
        $ARGUMENTS
        ```
        
        在继续之前，你**必须**考虑用户输入（如果不为空）。
        
        ## 概述
        
        目标：[命令的主要目标]
        
        注意：[重要提示或前置条件]
        
        执行步骤：
        
        1. **步骤 1 标题**
           - 子步骤说明
           - 具体操作指导
           - 错误处理说明
        
        2. **步骤 2 标题**
           [类似结构]
        
        3. **验证步骤**
           - 验证条件 1
           - 验证条件 2
        
        4. **报告完成**
           - 报告内容 1
           - 报告内容 2
        
        行为规则：
        
        - 规则 1：[具体行为约束]
        - 规则 2：[错误处理规则]
        - 规则 3：[边界情况处理]
        
        Context for prioritization: {ARGS}
        ```
      - 前置元数据（Frontmatter）规则：
        - 使用 YAML frontmatter 定义命令元数据
        - `description`：命令的简要描述
        - `handoffs`：定义命令之间的交接点（可选）
        - `scripts`：定义支持的脚本（bash/powershell，可选）
      - 执行步骤规则：
        - 步骤应该清晰、可执行
        - 包含错误处理和验证
        - 说明如何使用脚本和占位符

   c. **检查清单模板**（如果需要）：
      - 参考 `.specify/templates/checklist-template.md`
      - 使用以下结构模式：
        ```markdown
        # [检查清单类型] 检查清单：[占位符-名称]
        
        **目的**：[检查清单的用途]  
        **创建日期**：[占位符-日期]  
        **功能**：[指向相关文档的链接]
        
        **注意**：此检查清单由 [命令名称] 根据 [上下文] 生成。
        
        <!-- 
          ============================================================================
          重要提示：下面的检查清单项目仅为示例，仅用于说明。
          
          [命令名称] 必须根据以下内容替换为实际项目：
          - [数据源 1]
          - [数据源 2]
          - [数据源 3]
          
          不要在生成的检查清单文件中保留这些示例项目。
          ============================================================================
        -->
        
        ## [类别 1]
        
        - [ ] CHK001 [具体检查项目描述]
        - [ ] CHK002 [具体检查项目描述]
        - [ ] CHK003 [具体检查项目描述]
        
        ## [类别 2]
        
        - [ ] CHK004 [具体检查项目描述]
        - [ ] CHK005 [具体检查项目描述]
        
        ## 备注
        
        - [使用说明 1]
        - [使用说明 2]
        - [使用说明 3]
        ```
      - 检查清单规则：
        - 每个项目应该有唯一标识符（CHK001, CHK002 等）
        - 项目应该可操作、可验证
        - 按类别组织
        - 包含使用说明

5. **应用占位符系统**

   为所有模板应用统一的占位符系统：

   a. **动态占位符**（运行时替换）：
      - `$ARGUMENTS`：用户输入参数
      - `{ARGS}`：上下文参数
      - `[###-feature-name]`：功能分支名称模式（如适用）
      - `[日期]`：当前日期
      - `[功能名称]`：功能名称（如适用）

   b. **静态占位符**（模板填充时替换）：
      - `[占位符-描述]`：需要根据上下文填充的内容
      - `[选项 1/选项 2]`：多选占位符

   c. **脚本占位符**（脚本执行时替换）：
      - `{SCRIPT}`：脚本路径
      - `{ARGS}`：脚本参数

   d. **占位符命名规范**：
      - 使用描述性名称：`[功能名称]` 而不是 `[名称]`
      - 使用连字符分隔：`[feature-name]` 而不是 `[featureName]`
      - 保持一致性：相同类型的占位符使用相同格式

6. **添加注释和指导说明**

   为所有模板添加详细的注释和指导说明：

   a. **HTML 注释块**：
      ```markdown
      <!--
        重要提示：[关键信息]
        
        需要操作：[具体操作指导]
        
        注意事项：
        - 注意点 1
        - 注意点 2
      -->
      ```

   b. **内联注释**：
      ```markdown
      ## 部分标题 *（必需）*  <!-- 或 *（可选）* -->
      ```

   c. **示例和说明**：
      ```markdown
      **示例**：
      - **项目 1**：[示例内容]
      - **项目 2**：[示例内容]
      
      *标记不明确需求的示例：*
      - **FR-006**：系统必须 [需要澄清：具体问题]
      ```

7. **验证模板质量**

   对生成的每个模板进行质量检查：

   a. **结构完整性**：
      - [ ] 所有必需部分都已定义
      - [ ] 部分顺序合理
      - [ ] 层次结构清晰（使用正确的标题级别）

   b. **占位符系统**：
      - [ ] 所有占位符都有清晰的描述
      - [ ] 占位符命名一致
      - [ ] 占位符类型明确（动态/静态/脚本）

   c. **指导说明**：
      - [ ] 每个部分都有注释说明用途
      - [ ] 必需部分和可选部分已标记
      - [ ] 提供了填写指导

   d. **可执行性**（命令模板）：
      - [ ] 命令模板包含完整的执行步骤
      - [ ] 步骤之间有清晰的依赖关系
      - [ ] 包含错误处理和验证

   e. **一致性**：
      - [ ] 所有模板遵循相同的设计模式
      - [ ] 术语使用一致
      - [ ] 格式风格统一

8. **创建 README.md**

   在 `.specoutput/[task-folder-name]/` 目录下创建 README.md 文件，说明：
   - 模板系统的目的和用途
   - 目录结构说明
   - 如何使用各个模板
   - 占位符说明
   - 示例用法
   - 创建日期和任务描述

9. **报告完成**

   报告生成结果，包括：
   - 任务文件夹路径：`.specoutput/[task-folder-name]/`
   - 创建的完整目录结构（树状图）
   - 生成的模板文件列表（包含完整路径）
   - 每个模板的用途说明
   - 如何使用这些模板的简要说明
   - 下一步建议

## 核心原则

在生成模板时，始终遵循以下原则：

1. **模板即代码**：模板应该像代码一样结构化、可维护、可版本控制
2. **占位符驱动**：使用清晰的占位符标记需要替换的内容
3. **自文档化**：模板本身包含详细的注释和指导说明
4. **分层结构**：支持多层次的模板（文档模板、命令模板、检查清单模板等）
5. **可组合性**：模板可以引用和组合其他模板

## 参考模板

在生成新模板时，参考以下现有模板：

- `.specify/templates/spec-template.md`：文档模板示例
- `.specify/templates/plan-template.md`：计划文档模板示例
- `.specify/templates/checklist-template.md`：检查清单模板示例
- `.specify/templates/commands/specify.md`：命令模板示例
- `.specify/templates/commands/clarify.md`：命令模板示例（包含详细执行步骤）

## 最佳实践

### 1. 模板设计

- **保持简洁**：模板应该清晰、不冗余
- **提供示例**：在模板中包含好的和坏的示例
- **标记必需项**：明确区分必需和可选部分
- **自包含**：模板应该包含足够的信息，无需外部文档

### 2. 占位符设计

- **描述性**：占位符名称应该清楚表达期望的内容
- **一致性**：相同类型的占位符使用相同格式
- **可扩展**：考虑未来可能的需求变化

### 3. 指导说明

- **详细但不过度**：提供足够的指导，但不要过度解释
- **上下文相关**：说明应该与模板的特定用途相关
- **可操作**：指导应该帮助用户/智能体执行操作

### 4. 命令模板

- **步骤清晰**：每个步骤应该独立、可执行
- **错误处理**：包含错误情况的处理说明
- **验证机制**：包含验证步骤确保正确执行

## 行为规则

- **目录创建**：
  - 所有生成的文件必须在 `.specoutput/[task-folder-name]/` 目录下
  - 如果 `.specoutput` 目录不存在，先创建它
  - 如果任务文件夹已存在，使用带时间戳的名称避免覆盖
  - 确保所有必要的子目录都已创建（templates/、commands/、scripts/ 等）

- **文件生成**：
  - 所有模板文件必须使用绝对路径或相对于任务文件夹的路径
  - 确保文件路径正确，文件写入到正确的位置
  - 如果文件已存在，询问用户是否覆盖或使用新名称

- **需求处理**：
  - 如果用户输入为空或不明确，询问用户以澄清需求
  - 如果用户没有指定模板类型，根据常见模式推断（文档模板、命令模板等）
  - 如果用户没有指定目录结构，使用标准结构（templates/、commands/ 子目录等）

- **质量保证**：
  - 生成的模板应该可以直接使用，无需额外修改
  - 保持与 `.specify` 模板系统的一致性
  - 所有模板文件都应该包含完整的注释和指导说明

Context for prioritization: {ARGS}
